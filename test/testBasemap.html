<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Page</title>
    <style>
        .layerTile { position: absolute; }
    </style>
</head>
<body>
    <div id="basemapG" style="height:100px; width:100px;" ></div>
    <div id="map" style="height:90%; width: 100%;"></div>
    <script src="../dist/geoapi.js"></script>
    <script>
        var esriMap;
        geoapi('http://js.arcgis.com/3.20/', window).then(function (api) {
            api.mapManager.setProxy('http://cp.zz9.ca/index');
            var extentLCC = api.mapManager.Extent(-1651320, 4885090, 8887040, 11367400, new api.proj.SpatialReference({ wkid: 3978 }));
            var extentWeb = api.mapManager.Extent(-20037507, -20037507, 20037507, 20037507, new api.proj.SpatialReference({ wkid: 102100 }));
            var extentLL = api.mapManager.Extent(-180, -90, 180, 90, new api.proj.SpatialReference({ wkid: 4326 }));
            esriMap = api.mapManager.Map(document.getElementById('map'), { extent: extentWeb });

            var settingsLCC = {"basemaps": [
                {
                  "id": "baseNrCan",
                  "layers": [{
                      "url": "http://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBMT3978/MapServer/WMTS/tile/1.0.0/BaseMaps_CBCT3978/",
                      "type": "WebTiledLayer",
                      "templateUrl": "http://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/CBCT3978/MapServer/WMTS/tile/1.0.0/BaseMaps_CBCT3978/default/default028mm/${level}/${row}/${col}.jpg"
                    }]
                },
                {
                  "id": "baseSimple",
                  "layers": [{
                      "url": "http://geoappext.nrcan.gc.ca/arcgis/rest/services/BaseMaps/Simple/MapServer"
                    }]
              }]
            };

            var settingsWeb = {"basemaps": [
                {
                  "id": "baseNrCan",
                  "name": "Vector tile",
                  "layers": [{
                      "styleUrl": "https://www.arcgis.com/sharing/rest/content/items/dfcb45f8a2ad4b58a1a7547188a0a00c/resources/styles/root.json",
                      "type": "VectorTileLayer"
                    }]
              },
              {
                "id": "baseSimple",
                "name": "World Physical Map",
                "layers": [{
                    "url": "http://services.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer"
                  }]
              },
              {
                "id": "baseWMTS",
                "name": "WMTS ESRI",
                "layers": [{
                    "url": "http://services.arcgisonline.com/arcgis/rest/services/Demographics/USA_Population_Density/MapServer/WMTS/tile/1.0.0/Demographics_USA_Population_Density",
                    "type": "WebTiledLayer",
                    "templateUrl": "http://services.arcgisonline.com/arcgis/rest/services/Demographics/USA_Population_Density/MapServer/WMTS/tile/1.0.0/Demographics_USA_Population_Density/default/GoogleMapsCompatible/${level}/${row}/${col}.jpg"
                  }]
               }]
            }

            var settingsLL = {"basemaps": [
                {
                  "id": "baseNrCan",
                  "name": "WMTS",
                  "layers": [
                      {
                        "url": "https://gibs.earthdata.nasa.gov/wmts/epsg4326/best",
                        "type": "WebTiledLayer",
                        "templateUrl": "https://gibs.earthdata.nasa.gov/wmts/epsg4326/best/MODIS_Terra_CorrectedReflectance_TrueColor/default/2012-07-09/250m/${level}/${row}/${col}.jpg"
                    }
                  ]
              }]
          }

            var mapControls = api.mapManager.setupMap(esriMap, settingsWeb);
            // mapControls.BasemapControl.setBasemap('baseSimple') // need to load baseSimple before to set spatial ref. If not Vector wont load.

            // make sure returned object works properly
            setTimeout(() => {
                mapControls.BasemapControl.setBasemap('baseWMTS');
                esriMap.addLayer(new api.layer.FeatureLayer('http://geoappext.nrcan.gc.ca/arcgis/rest/services/NACEI/energy_infrastructure_of_north_america_en/MapServer/15'));
                // esriMap.addLayer(new api.layer.VectorTileLayer('https://www.arcgis.com/sharing/rest/content/items/dfcb45f8a2ad4b58a1a7547188a0a00c/resources/styles/root.json'));
                // var WMTSInfo = new api.layer.WMTSLayerInfo({
                //                                             identifier: "SP1996NC_3857",
                //                                             tileMatrixSet: "GoogleMapsCompatible",
                //                                             format: "png"
                //                                         });
                // var options = { serviceMode: "RESTful", layerInfo: WMTSInfo}
                // esriMap.addLayer(new api.layer.WMTSLayer('https://gibs.earthdata.nasa.gov/wmts//epsg4326/best'));
            }, 4000);

        });
</script>
</body>
</html>
